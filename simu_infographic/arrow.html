<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Arrow 1</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000000;
            width: 223px;
            height: 619px;
            position: relative;
        }

        .panel {
            position: absolute;
            left: 16px;
            background: #3F3F3F;
            width: 190.88px;
            padding: 4px;
            box-sizing: border-box;
        }

        .panel-title {
            color: white;
            font-size: 14px;
            margin: 0 0 21px 0;
            padding-left: 4px;
        }

        .value-container {
            display: flex;
            gap: 31px;
            align-items: flex-start;
            padding-left: 4px;
        }

        .scale {
            display: flex;
            flex-direction: column;
            gap: 15.61px;
            color: white;
            font-size: 14px;
        }

        .value-display {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .value {
            color: white;
            font-size: 36px;
        }

        .arrow {
            width: 22.44px;
            height: 29.93px;
            opacity: 0;
            transition: opacity 0.3s;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .arrow.show {
            opacity: 1;
        }

        .arrow.red.up {
            background-image: url('../arrow/red-up.png');
        }

        .arrow.red.down {
            background-image: url('../arrow/red-down.png');
        }

        .arrow.yellow.up {
            background-image: url('arrow/yellow-up.png');
        }

        .arrow.yellow.down {
            background-image: url('arrow/yellow-down.png');
        }

        .divider {
            width: 166.44px;
            height: 1px;
            background: white;
            margin: 13px 0;
        }

        /* Panel specific positions */
        .spo2-panel {
            top: 12px;
            height: 124.24px;
        }

        .hr-panel {
            top: 147.76px;
            height: 124.24px;
        }

        .pleth-panel {
            top: 283.52px;
            height: 180px;
        }

        .temp-panel {
            top: 475.27px;
            height: 124.24px;
        }
    </style>
</head>
<body>
    <!-- SpO2 Panel -->
    <div class="panel spo2-panel">
        <div class="panel-title">SpO2</div>
        <div class="value-container">
            <div class="scale">
                <div>100</div>
                <div>90</div>
            </div>
            <div class="value-display">
                <div class="value">98</div>
                <div class="arrow"></div>
            </div>
        </div>
    </div>

    <!-- HR Panel -->
    <div class="panel hr-panel">
        <div class="panel-title">HR</div>
        <div class="value-container">
            <div class="scale">
                <div>120</div>
                <div>60</div>
            </div>
            <div class="value-display">
                <div class="value">72</div>
                <div class="arrow"></div>
            </div>
        </div>
    </div>

    <!-- Pleth Panel -->
    <div class="panel pleth-panel">
        <div class="panel-title">Pleth</div>
        <div class="value-container">
            <div class="scale">
                <div>140</div>
                <div>90</div>
            </div>
            <div class="value-display">
                <div class="value bp1">120</div>
                <div class="arrow"></div>
            </div>
        </div>
        <div class="divider"></div>
        <div class="value-container">
            <div class="scale">
                <div>90</div>
                <div>60</div>
            </div>
            <div class="value-display">
                <div class="value bp2">75</div>
                <div class="arrow"></div>
            </div>
        </div>
    </div>

    <!-- Temp Panel -->
    <div class="panel temp-panel">
        <div class="panel-title">Temp</div>
        <div class="value-container">
            <div class="scale">
                <div>37.3</div>
                <div>36.0</div>
            </div>
            <div class="value">36.8</div>
        </div>
    </div>

    <script>
        // 定义参数范围
        const RANGES = {
            SpO2: {
                red: { min: 0, max: 90 },
                green: { min: 90, max: 100 }
            },
            HR: {
                red: { min: 0, max: 50, min2: 120, max2: Infinity },
                yellow: { min: 50, max: 60, min2: 100, max2: 120 },
                green: { min: 60, max: 100 }
            },
            Pleth: {
                bp1: {
                    red: { min: 0, max: 90, min2: 140, max2: Infinity },
                    yellow: { min: 120, max: 140 },
                    green: { min: 90, max: 120 }
                },
                bp2: {
                    red: { min: 0, max: 60, min2: 90, max2: Infinity },
                    yellow: { min: 80, max: 90 },
                    green: { min: 60, max: 80 }
                }
            },
            Temp: {
                red: { min: 0, max: 35.5, min2: 38, max2: Infinity },
                yellow: { min: 35.5, max: 36, min2: 37.3, max2: 38 },
                green: { min: 36, max: 37.3 }
            }
        };

        // 存储历史数据
        const history = {
            SpO2: [],
            HR: [],
            Pleth_bp1: [],
            Pleth_bp2: [],
            Temp: []
        };

        // 判断值所在的区间
        function getValueZone(value, ranges) {
            for (const [zone, range] of Object.entries(ranges)) {
                if (range.min2 !== undefined) {
                    if ((value >= range.min && value <= range.max) || 
                        (value >= range.min2 && value <= range.max2)) {
                        return zone;
                    }
                } else {
                    if (value >= range.min && value <= range.max) {
                        return zone;
                    }
                }
            }
            return null;
        }

        // 更新箭头状态
        function updateArrow(param, value, arrow) {
            // 获取历史数据
            const history = param === 'SpO2' ? spo2History :
                          param === 'HR' ? hrHistory :
                          param === 'Pleth_bp1' ? plethBP1History :
                          param === 'Pleth_bp2' ? plethBP2History :
                          tempHistory;

            if (history.length < 2) {
                arrow.classList.remove('show', 'up', 'down', 'red', 'yellow');
                return;
            }

            const lastValue = history[history.length - 2];
            const diff = value - lastValue;

            if (Math.abs(diff) < 0.01) {
                arrow.classList.remove('show', 'up', 'down', 'red', 'yellow');
                return;
            }

            arrow.classList.add('show');
            
            // 根据变化方向设置箭头方向
            if (diff > 0) {
                arrow.classList.add('up');
                arrow.classList.remove('down');
            } else {
                arrow.classList.add('down');
                arrow.classList.remove('up');
            }

            // 根据变化幅度设置箭头颜色
            if (Math.abs(diff) >= getThreshold(param)) {
                arrow.classList.add('red');
                arrow.classList.remove('yellow');
            } else {
                arrow.classList.add('yellow');
                arrow.classList.remove('red');
            }
        }

        // 当前值存储
        let currentValues = {
            spo2: 98,
            hr: 72,
            plethBP1: 120,
            plethBP2: 75,
            temp: 36.8
        };

        // 目标值存储
        let targetValues = {
            spo2: 98,
            hr: 72,
            plethBP1: 120,
            plethBP2: 75,
            temp: 36.8
        };

        // 每次更新的最大变化量
        const MAX_CHANGE = {
            spo2: 1,      // 血氧饱和度变化缓慢
            hr: 2,        // 心率可以相对快速变化
            plethBP1: 1.5, // 收缩压变化适中
            plethBP2: 1,   // 舒张压变化较慢
            temp: 0.1     // 体温变化非常缓慢
        };

        // 生成新的目标值
        function generateNewTarget(param, current) {
            let newTarget;
            switch(param) {
                case 'spo2':
                    // 90%概率在正常范围，10%概率下降
                    newTarget = Math.random() < 0.9 ?
                        95 + Math.random() * 5 :  // 95-100
                        85 + Math.random() * 5;   // 85-90
                    break;
                case 'hr':
                    // 80%概率在正常范围
                    newTarget = Math.random() < 0.8 ?
                        70 + Math.random() * 20 :  // 70-90
                        Math.random() < 0.5 ?
                            100 + Math.random() * 30 :  // 100-130
                            45 + Math.random() * 15;    // 45-60
                    break;
                case 'plethBP1':
                    newTarget = Math.random() < 0.8 ?
                        95 + Math.random() * 20 :  // 95-115
                        Math.random() < 0.5 ?
                            125 + Math.random() * 25 :  // 125-150
                            75 + Math.random() * 15;    // 75-90
                    break;
                case 'plethBP2':
                    newTarget = Math.random() < 0.8 ?
                        65 + Math.random() * 10 :  // 65-75
                        Math.random() < 0.5 ?
                            85 + Math.random() * 15 :  // 85-100
                            45 + Math.random() * 15;   // 45-60
                    break;
                case 'temp':
                    newTarget = Math.random() < 0.8 ?
                        36.2 + Math.random() * 1.0 :  // 36.2-37.2
                        Math.random() < 0.5 ?
                            37.4 + Math.random() * 0.8 :  // 37.4-38.2
                            35.8 + Math.random() * 0.4;   // 35.8-36.2
                    break;
            }
            return newTarget;
        }

        // 平滑更新当前值向目标值过渡
        function updateValue(param) {
            if (Math.abs(currentValues[param] - targetValues[param]) < 0.01) {
                targetValues[param] = generateNewTarget(param, currentValues[param]);
            }
            
            const diff = targetValues[param] - currentValues[param];
            const change = Math.min(Math.abs(diff), MAX_CHANGE[param]) * Math.sign(diff);
            currentValues[param] += change;
            
            return param === 'temp' ? 
                currentValues[param].toFixed(1) : 
                Math.round(currentValues[param]);
        }

        // 模拟数据更新
        function simulateDataUpdates() {
            // SpO2模拟
            const spo2Value = document.querySelector('.spo2-panel .value');
            const spo2Arrow = document.querySelector('.spo2-panel .arrow');
            
            // HR模拟
            const hrValue = document.querySelector('.hr-panel .value');
            const hrArrow = document.querySelector('.hr-panel .arrow');
            
            // Pleth模拟
            const plethBP1Value = document.querySelector('.pleth-panel .bp1');
            const plethBP1Arrow = document.querySelector('.pleth-panel .value-container:first-of-type .arrow');
            const plethBP2Value = document.querySelector('.pleth-panel .bp2');
            const plethBP2Arrow = document.querySelector('.pleth-panel .value-container:last-of-type .arrow');
            
            // Temp模拟
            const tempValue = document.querySelector('.temp-panel .value');

            setInterval(() => {
                // 平滑更新所有参数
                const newSpo2 = updateValue('spo2');
                const newHR = updateValue('hr');
                const newPlethBP1 = updateValue('plethBP1');
                const newPlethBP2 = updateValue('plethBP2');
                const newTemp = updateValue('temp');

                spo2Value.textContent = newSpo2;
                hrValue.textContent = newHR;
                plethBP1Value.textContent = newPlethBP1;
                plethBP2Value.textContent = newPlethBP2;
                tempValue.textContent = newTemp;

                // 更新箭头状态
                updateArrow('SpO2', newSpo2, spo2Arrow);
                updateArrow('HR', newHR, hrArrow);
                updateArrow('Pleth_bp1', newPlethBP1, plethBP1Arrow);
                updateArrow('Pleth_bp2', newPlethBP2, plethBP2Arrow);
            }, 1000);  // 每秒更新一次
        }

        // 启动模拟
        simulateDataUpdates();
    </script>
</body>
</html> 