<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命体征监测</title>
    <style>
        body {
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .monitor-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard {
            position: relative;
            width: 160px;
            height: 80px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .dashboard-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }
        
        .gauge {
            width: 100%;
            height: 100%;
            position: absolute;
            top: -10px;
            left: 0px;
        }

        .semi-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 25%;
        }

        .gauge-red {
            fill: none;
            stroke: #FF3B30;
            stroke-width: 10;
        }

        .gauge-yellow {
            fill: none;
            stroke: #FFD700;
            stroke-width: 10;
        }

        .gauge-green {
            fill: none;
            stroke: #34C759;
            stroke-width: 10;
        }

        .pointer {
            fill: white;
            transform-origin: bottom;
            transition: transform 0.5s ease;
        }

        .pointer-base {
            fill: white;
        }

        .value {
            fill: white;
            font-size: 40px;
            font-family: Arial, sans-serif;
            text-anchor: middle;
        }

        .scale-text {
            fill: white;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }

        .spo2-value {
            color: white;
            font-size: 72px;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px 0;
        }

        .monitor-block {
            position: relative;
            width: 160px;
            height: 160px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .block-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }

        .bp-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .bp-value {
            position: relative;
            height: auto;
        }

        .bp-value-systolic, .bp-value-diastolic {
            font-size: 40px;
            color: white;
            position: absolute;
            left: 35%;
            transform: translateX(-50%);
        }

        .bp-value-systolic {
            top: 30px;
        }

        .bp-value-diastolic {
            top: 110px;
        }

        .gauge-scale-systolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 30px;
        }

        .bp-divider {
            position: absolute;
            left: 20px;
            top: 100px;
            height: 1px;
            background-color: white;
            width: 50%; /* 控制分隔线的长度 */
        }

        .gauge-scale-diastolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 115px;
        }

        .gauge-segment {
            height: 6px;
            width: 100%;
        }

        .gauge-segment.red {
            background-color: #FF5757;
        }

        .gauge-segment.yellow {
            background-color: #FFCD05;
        }

        .gauge-segment.green {
            background-color: #00C764;
            height: 18px;
        }

        .gauge-limits-systolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 25px;
            position: absolute;
            left: 125px;
            top: 25px;
            align-items: flex-end;
        }
        
        .gauge-limits-diastolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 25px;
            position: absolute;
            left: 132px;
            top: 112px;
            align-items: flex-end;
        }

    </style>
</head>
<body>
    <div class="monitor-container">
        <!-- SpO2 血氧监测区域 -->
        <div class="dashboard spo2-dashboard">
            <div class="dashboard-title">SpO2</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- First segment (Red) -->
                <circle class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="213.47 351.017" stroke-dashoffset="121.37"/>
                <!-- Second segment (Green) -->
                <circle class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="27.27 537.217" stroke-dashoffset="-94.101"/>
        
                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="spo2-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前值显示 -->
                <text class="value" id="spo2-value" x="100" y="130">0</text>
        
                <!-- 刻度 -->
                <g>
                    <!-- 刻度值 -->
                    <text class="scale-text" x="185" y="85">90</text>
                </g>
            </svg>
        </div>

        <!-- HR 心率监测区域 -->
        <div class="dashboard hr-dashboard">
            <div class="dashboard-title">HR</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <path id="red1" class="gauge-red" d="M20,115 A90,90 0 0,1 31,78"/>
                <!-- 黄色区域1 -->
                <path id="yellow1" class="gauge-yellow" d="M32,77 A90,90 0 0,1 60,45"/>
                <!-- 绿色区域 -->
                <path id="green" class="gauge-green" d="M61,44 A90,90 0 0,1 139,44"/>
                <!-- 黄色区域2 -->
                <path id="yellow2" class="gauge-yellow" d="M140,45 A90,90 0 0,1 168,77"/>
                <!-- 红色区域2 -->
                <path id="red2" class="gauge-red" d="M169,78 A90,90 0 0,1 180,115"/>
            
                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="hr-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前心率显示 -->
                <text class="value" id="hr-value" x="100" y="130">0</text>
            
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <text class="scale-text" x="5" y="75">70</text>
                    <text class="scale-text" x="175" y="75">110</text>
                </g>
            </svg>
        </div>

        <!-- TEMP 体温监测区域 -->
        <div class="dashboard temp-dashboard">
            <div class="dashboard-title">TEMP</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <path id="red1" class="gauge-red" d="M20,115 A90,90 0 0,1 31,78"/>
                <!-- 黄色区域1 -->
                <path id="yellow1" class="gauge-yellow" d="M32,77 A90,90 0 0,1 60,45"/>
                <!-- 绿色区域 -->
                <path id="green" class="gauge-green" d="M61,44 A90,90 0 0,1 139,44"/>
                <!-- 黄色区域2 -->
                <path id="yellow2" class="gauge-yellow" d="M140,45 A90,90 0 0,1 168,77"/>
                <!-- 红色区域2 -->
                <path id="red2" class="gauge-red" d="M169,78 A90,90 0 0,1 180,115"/>
            
                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="temp-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/> <!-- 修改这里的y坐标来增加长度，并相应地调整transform-origin -->
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <text class="value" id="temp-value" x="100" y="130">0</text>
                
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <text class="scale-text" x="-5" y="75">35.5</text>
                    <text class="scale-text" x="175" y="75">37.5</text>
                </g>
            </svg>
        </div>

        <!-- BP 血压监测区域 -->
        <div class="monitor-block bp-block">
            <div class="block-title">BP</div>
            <div class="bp-content">
                <!-- 收缩压部分 -->
                <div class="bp-row">
                    <div class="bp-value-systolic">120</div>
        
                    <div class="gauge-limits-systolic">
                        <span>140</span>
                        <span>90</span>
                    </div>
        
                    <div class="gauge-scale-systolic">
                        <div id="red1" class="gauge-segment red"></div>
                        <div id="yellow1" class="gauge-segment yellow"></div>
                        <div id="green" class="gauge-segment green"></div>
                        <div id="yellow2" class="gauge-segment yellow"></div>
                        <div id="red2" class="gauge-segment red"></div>
                    </div>
                </div>
                
                <!-- 分割线 -->
                <div class="bp-divider"></div>
                
                <!-- 舒张压部分 -->
                <div class="bp-row">
                    <div class="bp-value-diastolic">80</div>
        
                    <div class="gauge-limits-diastolic">
                        <span>90</span>
                        <span>60</span>
                    </div>
        
                    <div class="gauge-scale-diastolic">
                        <div id="red1" class="gauge-segment red"></div>
                        <div id="yellow1" class="gauge-segment yellow"></div>
                        <div id="green" class="gauge-segment green"></div>
                        <div id="yellow2" class="gauge-segment yellow"></div>
                        <div id="red2" class="gauge-segment red"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 实验数据
        var simu_data = {
            "patient1": [
                {"name": "心率", "unit": "bpm", "initial_value": 110, "target_value": 130, "rate_of_change": 0.1818},
                {"name": "氧饱和度", "unit": "%", "initial_value": 94, "target_value": 88, "rate_of_change": -6.38},
                {"name": "收缩压", "unit": "mmHg", "initial_value": 100, "target_value": 85, "rate_of_change": -15.00},
                {"name": "舒张压", "unit": "mmHg", "initial_value": 60, "target_value": 50, "rate_of_change": -16.67},
                {"name": "体温", "unit": "°C", "initial_value": 37, "target_value": 37.2, "rate_of_change": 0.0054},
                {"name": "EtCO2", "unit": "mmHg", "initial_value": 35, "target_value": 30, "rate_of_change": -14.29}
            ]
        };

        // 提取心率信息
        let currentHeartRate = simu_data.patient1[0].initial_value;
        const targetHeartRate = simu_data.patient1[0].target_value;
        const totalSteps = 120;
        let stepCount = 0;

        // 通用函数
        function valueToAngle(value, min, max) {
            const minAngle = -90;
            const maxAngle = 90;
            return minAngle + (value - min) * (maxAngle - minAngle) / (max - min);
        }

        // 通用仪表更新函数
        function updateGauge(pointer, valueText, value, valmin, valmax) {
            if (pointer && valueText) {
                const angle = valueToAngle(value, valmin, valmax);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;
            }
        }

        // 各模块数据生成函数
        function generateHeartRate() {
            if (stepCount >= totalSteps) {
                return targetHeartRate; // 如果已经达到120次调用，返回目标值
            }

            const remainingSteps = totalSteps - stepCount;
            const remainingChange = targetHeartRate - currentHeartRate;

            // 计算每次变化的最大值，确保不会超过目标值
            const maxChange = remainingChange / remainingSteps;

            // 生成一个随机的变化值，确保单调增加或减少
            const randomChange = Math.random() * maxChange;

            // 更新当前心率值
            currentHeartRate += randomChange;

            stepCount++;

            return currentHeartRate;
        }


        function generateTemp() {
            // 80%概率生成36-37
            if (Math.random() < 0.8) {
                return 36 + Math.random(); // 注意这里直接使用Math.random()因为默认范围是[0,1)，所以加上36后范围变为[36,37)
            } else {
                // 剩下20%的情况，进一步区分是生成35-36还是37-38
                if (Math.random() < 0.5) {
                    // 10%的概率（相对于总概率）生成35-36
                    return 35 + Math.random();
                } else {
                    // 10%的概率（相对于总概率）生成37-38
                    return 37 + Math.random();
                }
            }
        }

        function generateSpO2() {
            // 80%概率生成80-100，20%概率生成0-80
            if (Math.random() < 0.8) {
                return Math.min(100, 80 + Math.random() * 20);
            }
            return Math.max(0, Math.random() * 80);
        }

        function generateBPData() {
            // 设置systolic和diastolic的基础值以及它们的范围
            const minSystolic = 90;
            const maxSystolic = 140;
            const minDiastolic = 60;
            const maxDiastolic = 90;

            return {
                systolic: Math.round(minSystolic + Math.random() * (maxSystolic - minSystolic)),
                diastolic: Math.round(minDiastolic + Math.random() * (maxDiastolic - minDiastolic))
            };
        }

        // 各模块更新函数
        function updateBP(systolic, diastolic) {
            document.querySelector('.bp-value-systolic').textContent = systolic;
            document.querySelector('.bp-value-diastolic').textContent = diastolic;
            updateBPGauge(systolic, 'systolic');
            updateBPGauge(diastolic, 'diastolic');
        }

        function updateBPGauge(value, type) {
            let gaugeSegments, thresholds;
            
            if (type === 'systolic') {
                gaugeSegments = document.querySelectorAll('.gauge-scale-systolic .gauge-segment');
                thresholds = [
                    {max: 100, segment: 4}, // red2
                    {min: 100, max: 110, segment: 3}, // yellow2
                    {min: 110, max: 120, segment: 2}, // green
                    {min: 120, max: 130, segment: 1}, // yellow1
                    {min: 130, segment: 0} // red1
                ];
            } else { // for diastolic
                gaugeSegments = document.querySelectorAll('.gauge-scale-diastolic .gauge-segment');
                thresholds = [
                    {max: 65, segment: 4}, // red2
                    {min: 65, max: 70, segment: 3}, // yellow2
                    {min: 70, max: 80, segment: 2}, // green
                    {min: 80, max: 85, segment: 2}, // yellow1
                    {min: 85, segment: 0} // red1
                ];
            }

            Array.from(gaugeSegments).forEach((segment, index) => {
                segment.style.opacity = index === thresholds.find(threshold => 
                    (threshold.min === undefined || value >= threshold.min) && 
                    (threshold.max === undefined || value < threshold.max)
                ).segment ? '1' : '0.3';
            });
        }

        function updateSpO2(value) {
            const pointer = document.getElementById('spo2-pointer');
            const valueText = document.getElementById('spo2-value');
            
            if (pointer && valueText) {
                // 计算指针的旋转角度
                const angle = valueToAngle(value, 0, 100);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = Math.round(value);

                // 设置颜色高亮
                const isGreen = value >= 90;
                document.querySelector('.gauge-red').style.opacity = isGreen ? 0.3 : 1;
                document.querySelector('.gauge-green').style.opacity = isGreen ? 1 : 0.3;
            }
        }

        function updateGaugeHR(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'hr-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#hr-pointer');
            const valueText = dashboard.querySelector('#hr-value');
            const regions = ['red1', 'yellow1', 'green', 'yellow2', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                const angle = valueToAngle(value, 60, 120);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (value >= 60 && value < 70) highlightRegion = 'red1';
                else if (value >= 70 && value < 80) highlightRegion = 'yellow1';
                else if (value >= 80 && value < 100) highlightRegion = 'green';
                else if (value >= 100 && value < 110) highlightRegion = 'yellow2';
                else if (value >= 110 && value <= 120) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }
        
        function updateGaugeTEMP(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'temp-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#temp-pointer');
            const valueText = dashboard.querySelector('#temp-value');
            const regions = ['red1', 'yellow1', 'green', 'yellow2', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                const angle = valueToAngle(value, 35, 38);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (value >= 35 && value < 35.5) highlightRegion = 'red1';
                else if (value >= 35.5 && value < 36) highlightRegion = 'yellow1';
                else if (value >= 36 && value < 37) highlightRegion = 'green';
                else if (value >= 37 && value < 37.5) highlightRegion = 'yellow2';
                else if (value >= 37.5 && value <= 38) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }

        // 初始化显示
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化心率
            updateGaugeHR(generateHeartRate());

            // 初始化体温
            updateGaugeTEMP(generateTemp());

            // 初始化SpO2
            updateSpO2(generateSpO2());

            // 初始化BP
            const initialBP = generateBPData();
            updateBP(initialBP.systolic, initialBP.diastolic);
        });

        // 定时更新所有数据
        setInterval(() => {
            // 更新心率
            updateGaugeHR(generateHeartRate());

            // 更新体温
            updateGaugeTEMP(generateTemp());

            // 更新SpO2
            updateSpO2(generateSpO2());

            // 更新BP
            const bpData = generateBPData();
            updateBP(bpData.systolic, bpData.diastolic);
        }, 2000);

        // 添加过渡效果
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .gauge-segment {
                    transition: opacity 0.3s ease;
                }
                .bp-value {
                    transition: color 0.3s ease;
                }
                #spo2-pointer, #hr-pointer, #temp-pointer {
                    transition: transform 0.3s ease;
                }
                .gauge-red, .gauge-green {
                    transition: opacity 0.3s ease;
                }
            </style>
        `);
    </script>
</body>
</html> 