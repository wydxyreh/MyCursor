<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命体征监测</title>
    <style>
        body {
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .monitor-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard {
            position: relative;
            width: 160px;
            height: 80px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .dashboard-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }
        
        .gauge {
            width: 100%;
            height: 100%;
            position: absolute;
            top: -10px;
            left: 0px;
        }

        .semi-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 25%;
        }

        .gauge-red {
            fill: none;
            stroke: #FF3B30;
            stroke-width: 10;
        }

        .gauge-yellow {
            fill: none;
            stroke: #FFD700;
            stroke-width: 10;
        }

        .gauge-green {
            fill: none;
            stroke: #34C759;
            stroke-width: 10;
        }

        .pointer {
            fill: white;
            transform-origin: bottom;
            transition: transform 0.5s ease;
        }

        .pointer-base {
            fill: white;
        }

        .value {
            fill: white;
            font-size: 40px;
            font-family: Arial, sans-serif;
            text-anchor: middle;
        }

        .scale-text {
            fill: white;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }

        .spo2-value {
            color: white;
            font-size: 72px;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px 0;
        }

        .monitor-block {
            position: relative;
            width: 160px;
            height: 160px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .block-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }

        .bp-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .bp-value {
            position: relative;
            height: auto;
        }

        .bp-value-systolic, .bp-value-diastolic {
            font-size: 40px;
            color: white;
            position: absolute;
            left: 35%;
            transform: translateX(-50%);
        }

        .bp-value-systolic {
            top: 30px;
        }

        .bp-value-diastolic {
            top: 110px;
        }

        .gauge-scale-systolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 30px;
        }

        .bp-divider {
            position: absolute;
            left: 20px;
            top: 100px;
            height: 1px;
            background-color: white;
            width: 50%; /* 控制分隔线的长度 */
        }

        .gauge-scale-diastolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 115px;
        }

        .gauge-segment {
            height: 6px;
            width: 100%;
        }

        /* BP1: 50-90红色, 90-120绿色, 120-140黄色, 140-180红色 */
        .gauge-segment.red-systolic-2 {   
            background-color: #FF5757;
            height: 10px;
        }

        .gauge-segment.yellow-systolic-2 {
            background-color: #FFCD05;
            height: 10px;
        }

        .gauge-segment.green-systolic {
            background-color: #00C764;
            height: 20px;
        }

        .gauge-segment.yellow-systolic-1 {
            background-color: #FFCD05;
            height: 10px;
        }

        .gauge-segment.red-systolic-1 {   
            background-color: #FF5757;
            height: 10px;
        }

        /* BP2: 50-60红色, 60-80绿色, 80-90黄色, 90-130红色 */
        .gauge-segment.red-diastolic-2 {
            background-color: #FF5757;
            height: 10px;
        }

        .gauge-segment.yellow-diastolic-2 {
            background-color: #FFCD05;
            height: 10px;
        }

        .gauge-segment.green-diastolic {
            background-color: #00C764;
            height: 20px;
        }

        .gauge-segment.yellow-diastolic-1 {
            background-color: #FFCD05;
            height: 10px;
        }

        .gauge-segment.red-diastolic-1 {
            background-color: #FF5757;
            height: 10px;
        }

        .gauge-limits-systolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 35px;
            position: absolute;
            left: 125px;
            top: 20px;
            align-items: flex-end;
        }
        
        .gauge-limits-diastolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 35px;
            position: absolute;
            left: 125px;
            top: 106px;
            align-items: flex-end;
        }

        .patient-buttons {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .patient-button {
            padding: 5px 10px;
            background: #3F3F3F;
            color: white;
            border: 1px solid #555;
            cursor: pointer;
        }

        .patient-button:hover {
            background: #4F4F4F;
        }

        .patient-button.selected {
            background: #5F5F5F;
            border: 2px solid #00FF00;
        }

        /* 当前病人信息容器 */
        .current-patient {
            position: fixed;
            top: 250px;
            right: 10px;
            background: #3F3F3F;
            padding: 10px;
            color: white;
            border: 1px solid #555;
            width: 250px; /* 稍微加宽以容纳两列 */
            display: none; /* 默认隐藏 */
        }

        .current-patient h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            text-align: center;
        }

        .current-patient .patient-data {
            display: flex;
            justify-content: space-between;
        }

        .current-patient .column {
            flex: 1;
            padding: 0 10px;
        }

        .current-patient p {
            margin: 5px 0;
            font-size: 14px;
        }

        .current-patient .label {
            font-weight: bold;
            color: #00FF00;
        }
    </style>
</head>
<body>
    <div class="monitor-container">
        <!-- SpO2 血氧监测区域 -->
        <div class="dashboard spo2-dashboard">
            <div class="dashboard-title">SpO2</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- First segment (Red) -->
                <circle class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="161.2 403.287" stroke-dashoffset="122.94"/>
                <!-- stroke-dashoffset 表示起始偏移量，为0时在圆心正上方，加数值的时候起始角度逆时针转，减数值的时候起始角度逆时针转；
                stroke-dasharray 第一个值表示弧度长度，顺时针增长，第二个值表示间隔，固定用 564.487 减去第一个值得到； -->
                <!-- Second segment (Green) -->
                <circle class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="83.74 480.747" stroke-dashoffset="-39.83"/>
        
                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="spo2-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前值显示 -->
                <text class="value" id="spo2-value" x="100" y="130">0</text>
        
                <!-- 刻度 -->
                <g>
                    <!-- 刻度值 -->
                    <text class="scale-text" x="0" y="120">0</text>
                    <text class="scale-text" x="140" y="45">90</text>
                    <text class="scale-text" x="195" y="120">100</text>
                </g>
            </svg>
        </div>

        <!-- HR 心率监测区域 -->
        <div class="dashboard hr-dashboard">
            <div class="dashboard-title">HR</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <circle id="red1" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="40.87 523.647" stroke-dashoffset="122.94"/>
                <!-- 黄色区域1 -->
                <circle id="yellow1" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="39.27 525.217" stroke-dashoffset="80.53"/>
                <!-- 绿色区域 -->
                <circle id="green" class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="76.97 487.517" stroke-dashoffset="39.69"/>
                <!-- 黄色区域2 -->
                <circle id="yellow2" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="39.27 525.217" stroke-dashoffset="-38.85"/>
                <!-- 红色区域2 -->
                <circle id="red2" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="43.98 517.367" stroke-dashoffset="-79.69"/>

                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="hr-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前心率显示 -->
                <text class="value" id="hr-value" x="100" y="130">0</text>
            
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <!-- <text class="scale-text" x="0" y="120">0</text> -->
                    <text class="scale-text" x="10" y="75">50</text>
                    <!-- <text class="scale-text" x="75" y="36">60</text> -->
                    <!-- <text class="scale-text" x="145" y="50">100</text> -->
                    <text class="scale-text" x="175" y="75">120</text>
                    <!-- <text class="scale-text" x="195" y="120">140</text> -->
                </g>
            </svg>
        </div>

        <!-- TEMP 体温监测区域 -->
        <div class="dashboard temp-dashboard">
            <div class="dashboard-title">TEMP</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <circle id="red1" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="40.87 523.647" stroke-dashoffset="122.94"/>
                <!-- 黄色区域1 -->
                <circle id="yellow1" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="39.27 525.217" stroke-dashoffset="80.53"/>
                <!-- 绿色区域 -->
                <circle id="green" class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="76.97 487.517" stroke-dashoffset="39.69"/>
                <!-- 黄色区域2 -->
                <circle id="yellow2" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="39.27 525.217" stroke-dashoffset="-38.85"/>
                <!-- 红色区域2 -->
                <circle id="red2" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="43.98 517.367" stroke-dashoffset="-79.69"/>

                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="temp-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/> <!-- 修改这里的y坐标来增加长度，并相应地调整transform-origin -->
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <text class="value" id="temp-value" x="100" y="130">0.0/text>
                
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <!-- <text class="scale-text" x="-25" y="120">35.5</text>
                    <text class="scale-text" x="15" y="65">36</text>
                    <text class="scale-text" x="150" y="50">37.3</text>
                    <text class="scale-text" x="200" y="120">38</text> -->
                    <text class="scale-text" x="-5" y="75">35.5</text>
                    <text class="scale-text" x="175" y="75">38</text>
                </g>
            </svg>
        </div>

        <!-- BP 血压监测区域 -->
        <div class="monitor-block bp-block">
            <div class="block-title">BP</div>
            <div class="bp-content">
                <!-- 收缩压部分 -->
                <div class="bp-row">
                    <div class="bp-value-systolic">120</div>
        
                    <div class="gauge-limits-systolic">
                        <span>180</span>
                        <span>50</span>
                    </div>
        
                    <div class="gauge-scale-systolic">
                        <div id="red1" class="gauge-segment red-systolic-2"></div>
                        <div id="yellow" class="gauge-segment yellow-systolic-2"></div>
                        <div id="green" class="gauge-segment green-systolic"></div>
                        <div id="yellow" class="gauge-segment yellow-systolic-1"></div>
                        <div id="red2" class="gauge-segment red-systolic-1"></div>
                    </div>
                </div>
                
                <!-- 分割线 -->
                <div class="bp-divider"></div>
                
                <!-- 舒张压部分 -->
                <div class="bp-row">
                    <div class="bp-value-diastolic">80</div>
        
                    <div class="gauge-limits-diastolic">
                        <span>130</span>
                        <span>50</span>
                    </div>
        
                    <div class="gauge-scale-diastolic">
                        <div id="red1" class="gauge-segment red-diastolic-2"></div>
                        <div id="yellow" class="gauge-segment yellow-diastolic-2"></div>
                        <div id="green" class="gauge-segment green-diastolic"></div>
                        <div id="yellow" class="gauge-segment yellow-diastolic-1"></div>
                        <div id="red2" class="gauge-segment red-diastolic-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加病人选择按钮 -->
    <div class="patient-buttons">
        <button class="patient-button" onclick="selectPatient(1)">Patient 1</button>
        <button class="patient-button" onclick="selectPatient(2)">Patient 2</button>
        <button class="patient-button" onclick="selectPatient(3)">Patient 3</button>
        <button class="patient-button" onclick="selectPatient(4)">Patient 4</button>
        <button class="patient-button" onclick="selectPatient(5)">Patient 5</button>
        <button class="patient-button" onclick="selectPatient(6)">Patient 6</button>
    </div>

    <div class="current-patient">
        <h3>Current Patient</h3>
        <div class="patient-data">
            <div class="column">
                <p class="label">Initial Values</p>
                <p>HR: <span id="initial-hr"></span></p>
                <p>SpO2: <span id="initial-spo2"></span></p>
                <p>BP: <span id="initial-bp1"></span>/<span id="initial-bp2"></span></p>
                <p>Temp: <span id="initial-temp"></span></p>
            </div>
            <div class="column">
                <p class="label">Target Values</p>
                <p>HR: <span id="target-hr"></span></p>
                <p>SpO2: <span id="target-spo2"></span></p>
                <p>BP: <span id="target-bp1"></span>/<span id="target-bp2"></span></p>
                <p>Temp: <span id="target-temp"></span></p>
            </div>
        </div>
    </div>

    <script>
        // 添加趋势控制系统
        const trendControl = {
            duration: 120,  // 2分钟 = 120秒
            startTime: null,
            initialValues: {
                spo2: 90,
                hr: 120,
                Pleth_bp1: 120,
                Pleth_bp2: 80,
                temp: 38.0
            },
            targetValues: {
                spo2: 90,
                hr: 130,
                Pleth_bp1: 160,
                Pleth_bp2: 100,
                temp: 38.0
            },
            isTransitioning: false
        };

        // 计算平滑过渡值的函数
        function calculateTransitionValue(initial, target, progress) {
            // 使用缓动函数使变化更自然
            progress = Math.sin(progress * Math.PI / 2);
            return initial + (target - initial) * progress;
        }

        // 生成随机数据的函数
        function generateRandomData() {
            if (!trendControl.isTransitioning) {
                return {
                    spo2: trendControl.initialValues.spo2,
                    hr: trendControl.initialValues.hr,
                    Pleth_bp1: trendControl.initialValues.Pleth_bp1,
                    Pleth_bp2: trendControl.initialValues.Pleth_bp2,
                    temp: trendControl.initialValues.temp
                };
            }

            const currentTime = Date.now();
            const progress = Math.min((currentTime - trendControl.startTime) / (trendControl.duration * 1000), 1);

            const result = {};
            Object.keys(trendControl.initialValues).forEach(metric => {
                const initial = trendControl.initialValues[metric];
                const target = trendControl.targetValues[metric];
                const baseValue = calculateTransitionValue(initial, target, progress);

                // 根据当前值和目标值之间的差值来决定波动范围
                let fluctuation;
                if (progress < 1) { // 如果还未完成过渡
                    fluctuation = Math.abs(baseValue - target) * 0.1; // 波动范围为差值的10%
                } else {
                    fluctuation = 0; // 最后一次更新直接设置为目标值
                }

                // 计算新值
                let newValue = baseValue + (Math.random() * 2 - 1) * fluctuation; // 随机增加或减少
                
                // 确保温度保留一位小数，其他指标取整
                if (metric === 'temp') {
                    result[metric] = parseFloat(newValue.toFixed(1));
                } else {
                    result[metric] = Math.floor(newValue);
                }
                
                // 当过渡结束时，确保值为目标值
                if (progress >= 1) {
                    result[metric] = target;
                }
            });

            if (progress >= 1) {
                trendControl.isTransitioning = false;
            }

            return result;
        }

        // 更新数据面板显示值
        function updatePanelValues(data) {
            // 更新心率
            updateGaugeHR(data.hr);
            // 更新体温
            updateGaugeTEMP(data.temp);
            // 更新SpO2
            updateSpO2(data.spo2);
            // 更新BP
            updateBP(data.Pleth_bp1, data.Pleth_bp2);
        }

        // 更新显示数据
        function updateMetricValues() {
            const newData = generateRandomData();
            // 只更新显示值
            updatePanelValues(newData);
        }

        // 通用函数
        function valueToAngle(value, min, max) {
            const minAngle = -90;
            const maxAngle = 90;
            return minAngle + (value - min) * (maxAngle - minAngle) / (max - min);
        }

        // 通用仪表更新函数
        function updateGauge(pointer, valueText, value, valmin, valmax) {
            if (pointer && valueText) {
                const angle = valueToAngle(value, valmin, valmax);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;
            }
        }

        // 各模块更新函数
        function updateBP(systolic, diastolic) {
            document.querySelector('.bp-value-systolic').textContent = systolic;
            document.querySelector('.bp-value-diastolic').textContent = diastolic;
            updateBPGauge(systolic, 'systolic');
            updateBPGauge(diastolic, 'diastolic');
        }

        function updateBPGauge(value, type) {
            let gaugeSegments, thresholds;
            
            if (type === 'systolic') {
                gaugeSegments = document.querySelectorAll('.gauge-scale-systolic .gauge-segment');
                thresholds = [
                    {min: 140, max: 180, segment: 0}, // red1
                    {min: 120, max: 140, segment: 1}, // yellow1
                    {min: 100, max: 120, segment: 2}, // green
                    {min: 90, max: 100, segment: 3}, // yellow2
                    {min: 50, max: 90, segment: 4} // red2
                ];
            } else { // for diastolic
                gaugeSegments = document.querySelectorAll('.gauge-scale-diastolic .gauge-segment');
                thresholds = [
                    {min: 90, max: 130, segment: 0}, // red1
                    {min: 80, max: 90, segment: 1}, // yellow1
                    {min: 70, max: 80, segment: 2}, // green
                    {min: 60, max: 70, segment: 3}, // yellow2
                    {min: 50, max: 60, segment: 4} // red2
                ];
            }

            Array.from(gaugeSegments).forEach((segment, index) => {
                segment.style.opacity = index === thresholds.find(threshold => 
                    (threshold.min === undefined || value >= threshold.min) && 
                    (threshold.max === undefined || value < threshold.max)
                ).segment ? '1' : '0.3';
            });
        }

        function updateSpO2(value) {
            const pointer = document.getElementById('spo2-pointer');
            const valueText = document.getElementById('spo2-value');
            
            if (pointer && valueText) {
                // 计算指针的旋转角度
                let angle_after_convert;
                if (value >= 0 && value < 90) {
                    // 0-90 映射到 0-80 度
                    angle_after_convert = (value / 90) * 80;
                } else if (value >= 90 && value <= 100) {
                    // 90-100 映射到 80-120 度
                    angle_after_convert = 80 + ((value - 90) / 10) * 40;
                } else if (value < 0) {
                    // 小于 0 映射到 0 度
                    angle_after_convert = 0;
                } else if (value > 100) {
                    // 大于 100 映射到 120 度
                    angle_after_convert = 120;
                }
                const angle = valueToAngle(angle_after_convert, 0, 120);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = Math.round(value);

                // 设置颜色高亮
                const isGreen = value >= 90;
                document.querySelector('.gauge-red').style.opacity = isGreen ? 0.3 : 1;
                document.querySelector('.gauge-green').style.opacity = isGreen ? 1 : 0.3;
            }
        }

        function updateGaugeHR(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'hr-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#hr-pointer');
            const valueText = dashboard.querySelector('#hr-value');
            const regions = ['red1', 'yellow1', 'green', 'yellow2', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                let angle_after_convert;
                if (value >= 0 && value < 50) {
                    // 0-50 映射到 0-20 度
                    angle_after_convert = (value / 50) * 20;
                } else if (value >= 50 && value < 60) {
                    // 50-60 映射到 20-40 度
                    angle_after_convert = 20 + ((value - 50) / 10) * 20;
                } else if (value >= 60 && value <= 100) {
                    // 60-100 映射到 40-80 度
                    angle_after_convert = 40 + ((value - 60) / 40) * 40;
                } else if (value > 100 && value <= 120) {
                    // 100-120 映射到 80-100 度
                    angle_after_convert = 80 + ((value - 100) / 20) * 20;
                } else if (value > 120 && value <= 140) {
                    // 120-140 映射到 100-120 度
                    angle_after_convert = 100 + ((value - 120) / 20) * 20;
                } else if (value < 0) {
                    // 小于 0 映射到 0 度
                    angle_after_convert = 0
                } else if (value > 140) {
                    // 大于 140 映射到 120 度
                    angle_after_convert = 120;
                }
                const angle = valueToAngle(angle_after_convert, 0, 120);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (angle_after_convert >= 0 && angle_after_convert < 20) highlightRegion = 'red1';
                else if (angle_after_convert >= 20 && angle_after_convert < 40) highlightRegion = 'yellow1';
                else if (angle_after_convert >= 40 && angle_after_convert <= 80) highlightRegion = 'green';
                else if (angle_after_convert > 80 && angle_after_convert <= 100) highlightRegion = 'yellow2';
                else if (angle_after_convert > 100 && angle_after_convert <= 120) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }
        
        function updateGaugeTEMP(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'temp-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#temp-pointer');
            const valueText = dashboard.querySelector('#temp-value');
            const regions = ['red1', 'yellow1', 'green', 'yellow2', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                let angle_after_convert;
                if (value >= 33 && value <= 35.5) {
                    // 33-35.5 映射到 0-20 度
                    angle_after_convert = ((value - 33) / (35.5 - 33)) * 20;
                } else if (value > 35.5 && value <= 36) {
                    // 35.5-36 映射到 20-40 度
                    angle_after_convert = 20 + ((value - 35.5) / (36 - 35.5)) * 20;
                } else if (value > 36 && value <= 37.3) {
                    // 36-37.3 映射到 40-80 度
                    angle_after_convert = 40 + ((value - 36) / (37.3 - 36)) * 40;
                } else if (value > 37.3 && value <= 38) {
                    // 37.3-38 映射到 80-100 度
                    angle_after_convert = 80 + ((value - 37.3) / (38 - 37.3)) * 20;
                } else if (value > 38 && value <= 42) {
                    // 38-42 映射到 100-120 度
                    angle_after_convert = 100 + ((value - 38) / (42 - 38)) * 20;
                } else if (value < 33) {
                    // 小于 33 映射到 0 度
                    angle_after_convert = 0;
                } else if (value > 42) {
                    // 大于 42 映射到 120 度
                    angle_after_convert = 120;
                }
                const angle = valueToAngle(angle_after_convert, 0, 120);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (angle_after_convert >= 0 && angle_after_convert < 20) highlightRegion = 'red1';
                else if (angle_after_convert >= 20 && angle_after_convert < 40) highlightRegion = 'yellow1';
                else if (angle_after_convert >= 40 && angle_after_convert <= 80) highlightRegion = 'green';
                else if (angle_after_convert > 80 && angle_after_convert <= 100) highlightRegion = 'yellow2';
                else if (angle_after_convert > 100 && angle_after_convert <= 120) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }

        // 初始化显示
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化心率
            updateGaugeHR(trendControl.initialValues.hr);

            // 初始化体温
            updateGaugeTEMP(trendControl.initialValues.temp);

            // 初始化SpO2
            updateSpO2(trendControl.initialValues.spo2);

            // 初始化BP
            updateBP(trendControl.initialValues.Pleth_bp1, trendControl.initialValues.Pleth_bp2);
        });

        // 添加过渡效果
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .gauge-segment {
                    transition: opacity 0.3s ease;
                }
                .bp-value {
                    transition: color 0.3s ease;
                }
                #spo2-pointer, #hr-pointer, #temp-pointer {
                    transition: transform 0.3s ease;
                }
                .gauge-red, .gauge-green {
                    transition: opacity 0.3s ease;
                }
            </style>
        `);

        // 用于存储定时器的 ID
        let metricIntervalId = null;
        let trendIntervalId = null;

        // 病人数据
        const patientData = {
            patient1: {
                initial: {
                    hr: 110,
                    spo2: 94,
                    Pleth_bp1: 100,
                    Pleth_bp2: 60,
                    temp: 37.0
                },
                target: {
                    hr: 130,
                    spo2: 88,
                    Pleth_bp1: 85,
                    Pleth_bp2: 50,
                    temp: 37.2
                }
            },
            patient2: {
                initial: {
                    hr: 95,
                    spo2: 88,
                    Pleth_bp1: 110,
                    Pleth_bp2: 65,
                    temp: 37.5
                },
                target: {
                    hr: 105,
                    spo2: 80,
                    Pleth_bp1: 105,
                    Pleth_bp2: 60,
                    temp: 37.8
                }
            },
            patient3: {
                initial: {
                    hr: 100,
                    spo2: 92,
                    Pleth_bp1: 90,
                    Pleth_bp2: 55,
                    temp: 38.5
                },
                target: {
                    hr: 120,
                    spo2: 88,
                    Pleth_bp1: 75,
                    Pleth_bp2: 45,
                    temp: 39.0
                }
            },
            patient4: {
                initial: {
                    hr: 85,
                    spo2: 96,
                    Pleth_bp1: 140,
                    Pleth_bp2: 85,
                    temp: 36.8
                },
                target: {
                    hr: 90,
                    spo2: 95,
                    Pleth_bp1: 150,
                    Pleth_bp2: 90,
                    temp: 37.2
                }
            },
            patient5: {
                initial: {
                    hr: 75,
                    spo2: 98,
                    Pleth_bp1: 120,
                    Pleth_bp2: 70,
                    temp: 36.5
                },
                target: {
                    hr: 110,
                    spo2: 90,
                    Pleth_bp1: 90,
                    Pleth_bp2: 50,
                    temp: 37.0
                }
            },
            patient6: {
                initial: {
                    hr: 80,
                    spo2: 97,
                    Pleth_bp1: 110,
                    Pleth_bp2: 70,
                    temp: 37.0
                },
                target: {
                    hr: 90,
                    spo2: 96,
                    Pleth_bp1: 100,
                    Pleth_bp2: 65,
                    temp: 38.0
                }
            }
        };

        // 选择病人函数
        function selectPatient(patientNumber) {
            const patient = patientData[`patient${patientNumber}`];

            // 清除所有按钮的选中状态
            document.querySelectorAll('.patient-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // 设置当前按钮为选中状态
            event.target.classList.add('selected');
            
            // 2. 重置 trendControl 参数并导入 patient.initial 和 patient.target 的数据
            trendControl.initialValues = {...patient.initial};
            trendControl.targetValues = {...patient.target};
            trendControl.startTime = Date.now();
            trendControl.isTransitioning = true;
            trendControl.duration = 120;

            // 清除之前的定时器
            if (metricIntervalId !== null) {
                clearInterval(metricIntervalId);
            }
            if (trendIntervalId !== null) {
                clearInterval(trendIntervalId);
            }

            updateMetricValues()
            
            // 开始新的定时器
            metricIntervalId = setInterval(updateMetricValues, 1000);  // 每秒更新显示值

            // 显示当前病人信息
            document.getElementById('initial-hr').textContent = patient.initial.hr;
            document.getElementById('initial-spo2').textContent = patient.initial.spo2;
            document.getElementById('initial-bp1').textContent = patient.initial.Pleth_bp1;
            document.getElementById('initial-bp2').textContent = patient.initial.Pleth_bp2;
            document.getElementById('initial-temp').textContent = patient.initial.temp;

            document.getElementById('target-hr').textContent = patient.target.hr;
            document.getElementById('target-spo2').textContent = patient.target.spo2;
            document.getElementById('target-bp1').textContent = patient.target.Pleth_bp1;
            document.getElementById('target-bp2').textContent = patient.target.Pleth_bp2;
            document.getElementById('target-temp').textContent = patient.target.temp;
            
            // 显示当前病人信息容器
            document.querySelector('.current-patient').style.display = 'block';
        }
    </script>
</body>
</html> 