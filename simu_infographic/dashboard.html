<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>生命体征监测</title>
    <style>
        body {
            background-color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .monitor-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .dashboard {
            position: relative;
            width: 160px;
            height: 80px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .dashboard-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }
        
        .gauge {
            width: 100%;
            height: 100%;
            position: absolute;
            top: -10px;
            left: 0px;
        }

        .semi-circle {
            transform: rotate(-90deg);
            transform-origin: 50% 25%;
        }

        .gauge-red {
            fill: none;
            stroke: #FF3B30;
            stroke-width: 10;
        }

        .gauge-yellow {
            fill: none;
            stroke: #FFD700;
            stroke-width: 10;
        }

        .gauge-green {
            fill: none;
            stroke: #34C759;
            stroke-width: 10;
        }

        .pointer {
            fill: white;
            transform-origin: bottom;
            transition: transform 0.5s ease;
        }

        .pointer-base {
            fill: white;
        }

        .value {
            fill: white;
            font-size: 40px;
            font-family: Arial, sans-serif;
            text-anchor: middle;
        }

        .scale-text {
            fill: white;
            font-size: 16px;
            font-family: Arial, sans-serif;
        }

        .spo2-value {
            color: white;
            font-size: 72px;
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px 0;
        }

        .monitor-block {
            position: relative;
            width: 160px;
            height: 160px;
            background-color: #3F3F3F;
            padding: 15px;
            border-radius: 4px;
        }

        .block-title {
            color: white;
            text-align: center;
            margin-bottom: -40px;
            font-size: 12px;
            position: absolute;
            left: 5px;
            top: 0px;
        }

        .bp-row {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .bp-value {
            position: relative;
            height: auto;
        }

        .bp-value-systolic, .bp-value-diastolic {
            font-size: 40px;
            color: white;
            position: absolute;
            left: 35%;
            transform: translateX(-50%);
        }

        .bp-value-systolic {
            top: 30px;
        }

        .bp-value-diastolic {
            top: 110px;
        }

        .gauge-scale-systolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 30px;
        }

        .bp-divider {
            position: absolute;
            left: 20px;
            top: 100px;
            height: 1px;
            background-color: white;
            width: 50%; /* 控制分隔线的长度 */
        }

        .gauge-scale-diastolic {
            width: 10px;
            height: 50px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            position: absolute;
            left: 150px;
            top: 115px;
        }

        .gauge-segment {
            height: 6px;
            width: 100%;
        }

        /* BP1: 50-90红色, 90-120绿色, 120-140黄色, 140-180红色 */
        .gauge-segment.red-systolic-2 {   
            background-color: #FF5757;
            height: 40px;
        }

        .gauge-segment.yellow-systolic {
            background-color: #FFCD05;
            height: 20px;
        }

        .gauge-segment.green-systolic {
            background-color: #00C764;
            height: 30px;
        }

        .gauge-segment.red-systolic-1 {   
            background-color: #FF5757;
            height: 40px;
        }

        /* BP2: 50-60红色, 60-80绿色, 80-90黄色, 90-130红色 */
        .gauge-segment.red-diastolic-2 {
            background-color: #FF5757;
            height: 40px;
        }

        .gauge-segment.yellow-diastolic {
            background-color: #FFCD05;
            height: 10px;
        }

        .gauge-segment.green-diastolic {
            background-color: #00C764;
            height: 20px;
        }

        .gauge-segment.red-diastolic-1 {
            background-color: #FF5757;
            height: 10px;
        }

        .gauge-limits-systolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 35px;
            position: absolute;
            left: 125px;
            top: 20px;
            align-items: flex-end;
        }
        
        .gauge-limits-diastolic {
            display: flex;
            flex-direction: column;
            color: white;
            font-size: 12px;
            gap: 35px;
            position: absolute;
            left: 125px;
            top: 106px;
            align-items: flex-end;
        }

    </style>
</head>
<body>
    <div class="monitor-container">
        <!-- SpO2 血氧监测区域 -->
        <div class="dashboard spo2-dashboard">
            <div class="dashboard-title">SpO2</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- First segment (Red) -->
                <circle class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="216.61 347.877" stroke-dashoffset="122.94"/>
                <!-- stroke-dashoffset 表示起始偏移量，为0时在圆心正上方，加数值的时候起始角度逆时针转，减数值的时候起始角度逆时针转；
                stroke-dasharray 第一个值表示弧度长度，顺时针增长，第二个值表示间隔，固定用 564.487 减去第一个值得到； -->
                <!-- Second segment (Green) -->
                <circle class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="28.84 535.647" stroke-dashoffset="-95.24"/>
        
                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="spo2-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前值显示 -->
                <text class="value" id="spo2-value" x="100" y="130">0</text>
        
                <!-- 刻度 -->
                <g>
                    <!-- 刻度值 -->
                    <text class="scale-text" x="0" y="120">0</text>
                    <text class="scale-text" x="185" y="85">90</text>
                    <text class="scale-text" x="195" y="120">100</text>
                </g>
            </svg>
        </div>

        <!-- HR 心率监测区域 -->
        <div class="dashboard hr-dashboard">
            <div class="dashboard-title">HR</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <circle id="red1" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="86.43 478.057" stroke-dashoffset="122.94"/>
                <!-- 黄色区域1 -->
                <circle id="yellow1" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="16.03 548.457" stroke-dashoffset="34.94"/>
                <!-- 绿色区域 -->
                <circle id="green" class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="65.69 498.797" stroke-dashoffset="17.34"/>
                <!-- 黄色区域2 -->
                <circle id="yellow2" class="semi-circle gauge-yellow" cx="5" cy="40" r="90" stroke="yellow" fill="none" stroke-width="10"
                stroke-dasharray="35.2 529.287" stroke-dashoffset="-49.92"/>
                <!-- 红色区域2 -->
                <circle id="red2" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="36.77 527.717" stroke-dashoffset="-86.69"/>

                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="hr-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/>
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <!-- 当前心率显示 -->
                <text class="value" id="hr-value" x="100" y="130">0</text>
            
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <text class="scale-text" x="0" y="120">0</text>
                    <text class="scale-text" x="50" y="43">50</text>
                    <text class="scale-text" x="75" y="36">60</text>
                    <text class="scale-text" x="145" y="50">100</text>
                    <text class="scale-text" x="175" y="75">120</text>
                    <text class="scale-text" x="195" y="120">140</text>
                </g>
            </svg>
        </div>

        <!-- TEMP 体温监测区域 -->
        <div class="dashboard temp-dashboard">
            <div class="dashboard-title">TEMP</div>
            <svg class="gauge" viewBox="0 0 200 150">
                <!-- 红色区域1 -->
                <circle id="red1" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="49.38 515.107" stroke-dashoffset="122.94"/>
                <!-- 绿色区域 -->
                <circle id="green" class="semi-circle gauge-green" cx="5" cy="40" r="90" stroke="green" fill="none" stroke-width="10"
                stroke-dasharray="122.1 442.387" stroke-dashoffset="71.99"/>
                <!-- 红色区域2 -->
                <circle id="red2" class="semi-circle gauge-red" cx="5" cy="40" r="90" stroke="red" fill="none" stroke-width="10"
                stroke-dasharray="72.28 492.207" stroke-dashoffset="-51.68"/>

                <!-- 指针 -->
                <defs>
                    <clipPath id="clip-pointer">
                        <rect x="97" y="20" width="6" height="35"/>
                    </clipPath>
                </defs>
                <g id="temp-pointer" style="transform-box: fill-box; transform-origin: center bottom;" clip-path="url(#clip-pointer)">
                    <path class="pointer" d="M97,65 L103,65 L100,20 Z" style="transform-origin: 100px 145px;"/> <!-- 修改这里的y坐标来增加长度，并相应地调整transform-origin -->
                    <circle class="pointer-base" cx="100" cy="100" r="15"/>
                </g>
                
                <text class="value" id="temp-value" x="100" y="130">0</text>
                
                <!-- 刻度 -->
                <g>
                    <!-- 黄色段刻度 -->
                    <text class="scale-text" x="-25" y="120">35.5</text>
                    <text class="scale-text" x="15" y="65">36</text>
                    <text class="scale-text" x="150" y="50">37.3</text>
                    <text class="scale-text" x="200" y="120">38</text>
                </g>
            </svg>
        </div>

        <!-- BP 血压监测区域 -->
        <div class="monitor-block bp-block">
            <div class="block-title">BP</div>
            <div class="bp-content">
                <!-- 收缩压部分 -->
                <div class="bp-row">
                    <div class="bp-value-systolic">120</div>
        
                    <div class="gauge-limits-systolic">
                        <span>180</span>
                        <span>50</span>
                    </div>
        
                    <div class="gauge-scale-systolic">
                        <div id="red1" class="gauge-segment red-systolic-2"></div>
                        <div id="yellow" class="gauge-segment yellow-systolic"></div>
                        <div id="green" class="gauge-segment green-systolic"></div>
                        <div id="red2" class="gauge-segment red-systolic-1"></div>
                    </div>
                </div>
                
                <!-- 分割线 -->
                <div class="bp-divider"></div>
                
                <!-- 舒张压部分 -->
                <div class="bp-row">
                    <div class="bp-value-diastolic">80</div>
        
                    <div class="gauge-limits-diastolic">
                        <span>130</span>
                        <span>50</span>
                    </div>
        
                    <div class="gauge-scale-diastolic">
                        <div id="red1" class="gauge-segment red-diastolic-2"></div>
                        <div id="yellow" class="gauge-segment yellow-diastolic"></div>
                        <div id="green" class="gauge-segment green-diastolic"></div>
                        <div id="red2" class="gauge-segment red-diastolic-1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 添加趋势控制系统
        const trendControl = {
            duration: 120,  // 2分钟 = 120秒
            startTime: null,
            initialValues: {
                spo2: 80,
                hr: 40,
                bpv1: 70,
                bpv2: 50,
                temp: 35.5
            },
            targetValues: {
                spo2: 90,
                hr: 130,
                bpv1: 160,
                bpv2: 100,
                temp: 38.0
            },
            isTransitioning: false
        };

        function generateRandomData() {
            if (!trendControl.isTransitioning) {
                return {
                    spo2: trendControl.initialValues.spo2,
                    hr: trendControl.initialValues.hr,
                    bpv1: trendControl.initialValues.bpv1,
                    bpv2: trendControl.initialValues.bpv2,
                    temp: trendControl.initialValues.temp
                };
            }

            const currentTime = Date.now();
            const progress = Math.min((currentTime - trendControl.startTime) / (trendControl.duration * 1000), 1);

            const result = {};
            Object.keys(trendControl.initialValues).forEach(metric => {
                const initial = trendControl.initialValues[metric];
                const target = trendControl.targetValues[metric];
                const baseValue = calculateTransitionValue(initial, target, progress);

                // 根据当前值和目标值之间的差值来决定波动范围
                let fluctuation;
                if (progress < 1) { // 如果还未完成过渡
                    fluctuation = Math.abs(baseValue - target) * 0.1; // 波动范围为差值的10%
                } else {
                    fluctuation = 0; // 最后一次更新直接设置为目标值
                }

                // 计算新值
                let newValue = baseValue + (Math.random() * 2 - 1) * fluctuation; // 随机增加或减少
                
                // 确保温度保留一位小数，其他指标取整
                if (metric === 'temp') {
                    result[metric] = parseFloat(newValue.toFixed(1));
                } else {
                    result[metric] = Math.floor(newValue);
                }
                
                // 当过渡结束时，确保值为目标值
                if (progress >= 1) {
                    result[metric] = target;
                }
            });

            if (progress >= 1) {
                trendControl.isTransitioning = false;
            }

            return result;
        }

        // 通用函数
        function valueToAngle(value, min, max) {
            const minAngle = -90;
            const maxAngle = 90;
            return minAngle + (value - min) * (maxAngle - minAngle) / (max - min);
        }

        // 通用仪表更新函数
        function updateGauge(pointer, valueText, value, valmin, valmax) {
            if (pointer && valueText) {
                const angle = valueToAngle(value, valmin, valmax);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;
            }
        }

        // 各模块数据生成函数
        function generateHeartRate() {
            return Math.random() * 140;
        }

        function generateTemp() {
            // 生成一个从35.5到38（不包括38）的随机数
            return 35.5 + Math.random() * (38 - 35.5);
        }

        function generateSpO2() {
            // 生成一个从0到100（包括0，但不包括100）的随机数
            return Math.random() * 100;
        }

        function generateBPData() {
            // 设置systolic和diastolic的基础值以及它们的范围
            const minSystolic = 50;
            const maxSystolic = 180;
            const minDiastolic = 50;
            const maxDiastolic = 130;

            return {
                systolic: Math.round(minSystolic + Math.random() * (maxSystolic - minSystolic)),
                diastolic: Math.round(minDiastolic + Math.random() * (maxDiastolic - minDiastolic))
            };
        }

        // 各模块更新函数
        function updateBP(systolic, diastolic) {
            document.querySelector('.bp-value-systolic').textContent = systolic;
            document.querySelector('.bp-value-diastolic').textContent = diastolic;
            updateBPGauge(systolic, 'systolic');
            updateBPGauge(diastolic, 'diastolic');
        }

        function updateBPGauge(value, type) {
            let gaugeSegments, thresholds;
            
            if (type === 'systolic') {
                gaugeSegments = document.querySelectorAll('.gauge-scale-systolic .gauge-segment');
                thresholds = [
                    {min: 140, max: 180, segment: 0}, // red1
                    {min: 120, max: 140, segment: 1}, // yellow
                    {min: 90, max: 120, segment: 2}, // green
                    {min: 50, max: 90, segment: 3} // red2
                ];
            } else { // for diastolic
                gaugeSegments = document.querySelectorAll('.gauge-scale-diastolic .gauge-segment');
                thresholds = [
                    {min: 90, max: 130, segment: 0}, // red1
                    {min: 80, max: 90, segment: 1}, // yellow
                    {min: 60, max: 80, segment: 2}, // green
                    {min: 50, max: 60, segment: 3} // red2
                ];
            }

            Array.from(gaugeSegments).forEach((segment, index) => {
                segment.style.opacity = index === thresholds.find(threshold => 
                    (threshold.min === undefined || value >= threshold.min) && 
                    (threshold.max === undefined || value < threshold.max)
                ).segment ? '1' : '0.3';
            });
        }

        function updateSpO2(value) {
            const pointer = document.getElementById('spo2-pointer');
            const valueText = document.getElementById('spo2-value');
            
            if (pointer && valueText) {
                // 计算指针的旋转角度
                const angle = valueToAngle(value, 0, 100);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = Math.round(value);

                // 设置颜色高亮
                const isGreen = value >= 90;
                document.querySelector('.gauge-red').style.opacity = isGreen ? 0.3 : 1;
                document.querySelector('.gauge-green').style.opacity = isGreen ? 1 : 0.3;
            }
        }

        function updateGaugeHR(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'hr-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#hr-pointer');
            const valueText = dashboard.querySelector('#hr-value');
            const regions = ['red1', 'yellow1', 'green', 'yellow2', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                const angle = valueToAngle(value, 0, 140);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (value >= 0 && value < 50) highlightRegion = 'red1';
                else if (value >= 50 && value < 60) highlightRegion = 'yellow1';
                else if (value >= 60 && value <= 100) highlightRegion = 'green';
                else if (value > 100 && value <= 120) highlightRegion = 'yellow2';
                else if (value > 120 && value <= 140) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }
        
        function updateGaugeTEMP(value) {
            // 通过传递的dashboardClass参数来定位具体的dashboard
            dashboardClass = 'temp-dashboard'
            const dashboard = document.querySelector(`.${dashboardClass}`);
            if (!dashboard) return; // 如果没有找到对应的dashboard，则返回

            const pointer = dashboard.querySelector('#temp-pointer');
            const valueText = dashboard.querySelector('#temp-value');
            const regions = ['red1', 'green', 'red2'];
            
            if (pointer && valueText) {
                // 计算角度
                const angle = valueToAngle(value, 35.5, 38);
                pointer.style.transform = `rotate(${angle}deg)`;
                valueText.textContent = typeof value === 'number' ? value.toFixed(1) : value;

                // 根据温度值确定哪个区域应被高亮显示
                let highlightRegion;
                if (value >= 35.5 && value < 36) highlightRegion = 'red1';
                else if (value >= 36 && value <= 37.3) highlightRegion = 'green';
                else if (value > 37.3 && value <= 38) highlightRegion = 'red2';

                // 更新各区域的透明度
                regions.forEach(region => {
                    const regionElement = dashboard.querySelector(`#${region}`);
                    if (regionElement) { // 确保找到了元素
                        if (region === highlightRegion) {
                            regionElement.style.opacity = '1.0'; // 高亮
                        } else {
                            regionElement.style.opacity = '0.3'; // 暗淡
                        }
                    }
                });
            }
        }

        // 初始化显示
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化心率
            updateGaugeHR(generateHeartRate());

            // 初始化体温
            updateGaugeTEMP(generateTemp());

            // 初始化SpO2
            updateSpO2(generateSpO2());

            // 初始化BP
            const initialBP = generateBPData();
            updateBP(initialBP.systolic, initialBP.diastolic);
        });

        // 定时更新所有数据
        setInterval(() => {
            // 更新心率
            updateGaugeHR(generateHeartRate());

            // 更新体温
            updateGaugeTEMP(generateTemp());

            // 更新SpO2
            updateSpO2(generateSpO2());

            // 更新BP
            const bpData = generateBPData();
            updateBP(bpData.systolic, bpData.diastolic);
        }, 2000);

        // 添加过渡效果
        document.head.insertAdjacentHTML('beforeend', `
            <style>
                .gauge-segment {
                    transition: opacity 0.3s ease;
                }
                .bp-value {
                    transition: color 0.3s ease;
                }
                #spo2-pointer, #hr-pointer, #temp-pointer {
                    transition: transform 0.3s ease;
                }
                .gauge-red, .gauge-green {
                    transition: opacity 0.3s ease;
                }
            </style>
        `);
    </script>
</body>
</html> 