<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPR监测</title>
    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: #000;
        }

        .monitor-container {
            width: 200px;
            height: 150px;
            background: #858585;
            position: relative;  /* 改为相对定位 */
            overflow: hidden;   /* 防止内容溢出 */
        }

        .monitor-content {
            width: 190.24px;
            height: 144.97px;
            position: absolute;  /* 改为绝对定位 */
            top: 1.7px;
            left: 4.16px;
        }

        .title {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            color: #fff;
            text-align: center;
            font-size: 16px;
            height: 20px;
            line-height: 20px;
        }

        .progress-bar {
            position: absolute;
            top: 24px;
            left: 9.43px;
            width: 171.38px;
            height: 14.36px;
            background: #323232;
            overflow: hidden;
        }

        .progress {
            width: 100%;
            height: 16.84px;
            background: #E4E4E4;
            transition: width 1s linear;
        }

        .ratio {
            position: absolute;
            right: 26.37px;
            top: 1.92px;
            color: #fff;
            font-size: 13px;
            z-index: 1;
        }

        .metrics {
            position: absolute;
            top: 42.36px;
            left: 9.62px;
            width: calc(100% - 19.24px);
            height: 18px;
            display: flex;
            justify-content: flex-start;
            gap: 22px;
            color: #fff;
            font-size: 14px;
        }

        .metric {
            display: flex;
            gap: 10px;
            white-space: nowrap;
            align-items: center;
        }

        .metric span {
            white-space: nowrap;
        }

        .metric-value {
            min-width: max-content;
        }

        .chart-container {
            position: absolute;
            top: 64.36px;
            left: 0;
            width: 100%;
            height: 55.61px;
        }

        .chart {
            position: absolute;
            top: 0;
            left: 18.28px;
            right: 18.28px;
            height: 52.61px;
            display: flex;
            gap: 6px;
        }

        .bar {
            width: 8.22px;
            transition: height 0.3s ease;
        }

        .bar.success {
            background: #00C764;
        }

        .bar.warning {
            background: #FFCD05;
        }

        .bar.danger {
            background: #FF5757;
        }

        .scale-line {
            position: absolute;
            left: 0;
            width: 100%;
            height: 1px;
            background: none;
            border-top: 1px dashed #fff;
        }

        .scale-line-1 {
            top: 50px;
        }

        .scale-line-2 {
            top: 60px;
        }

        .scale-value {
            position: absolute;
            left: 0;
            color: #fff;
            font-size: 12px;
        }

        .scale-value-1 {
            top: 36.00px;
        }

        .scale-value-2 {
            top: 60.00px;
        }

        .warnings {
            position: absolute;
            bottom: 0;
            left: 19.62px;
            right: 19.62px;
            height: 21px;
            display: flex;
            gap: 3px;
            color: #fff;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="monitor-container">
        <div class="monitor-content">
            <h1 class="title">CPR</h1>
            
            <div class="progress-bar">
                <div class="progress"></div>
                <span class="ratio">1:20</span>
            </div>

            <div class="metrics">
                <div class="metric">
                    <span>深度</span>
                    <span class="metric-value">5.5/cm</span>
                </div>
                <div class="metric">
                    <span>频率</span>
                    <span class="metric-value">100/min</span>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart"></div>
                <div class="scale-line scale-line-1"></div>
                <div class="scale-line scale-line-2"></div>
                <span class="scale-value scale-value-1">5.0</span>
                <span class="scale-value scale-value-2">6.0</span>
            </div>

            <div class="warnings">
                <span>按压过深！</span>
                <span>按压过快！</span>
            </div>
        </div>
    </div>

    <script>
        class CPRMonitor {
            constructor() {
                this.chart = document.querySelector('.chart');
                this.maxBars = 12; // 显示最近12次按压
                this.pressData = []; // 存储按压数据
                this.updateInterval = 1000; // 每 1 秒更新一次

                // 添加刻度线对应的深度值
                this.scaleMin = 5.0;
                this.scaleMax = 6.0;

                // 添加柱形图高度范围
                this.chartHeight = 100;
                this.line1Height = 50;
                this.line2Height = 60;

                // 添加倒计时相关属性
                this.totalTime = 120; // 总时长120秒
                this.remainingTime = this.totalTime;
                this.progressBar = document.querySelector('.progress');
                this.timeDisplay = document.querySelector('.ratio');

                // 启动监测
                this.startMonitoring();

                // 启动倒计时
                this.startCountdown();
            }

            // 深度转换为高度的计算方法
            depthToHeight(depth) {
                // 标注：修改了 depthToHeight 函数的计算逻辑以满足新的要求

                // 计算总的高度范围和深度范围
                const heightRange = this.chartHeight; // 总高度范围
                const depthRange = this.scaleMax - this.scaleMin; // 深度范围
                
                // 根据新要求设置的比例因子，使深度与高度呈线性关系
                const scaleFactor = heightRange / depthRange;

                // 如果深度小于最小刻度，则按照最小刻度的比例缩小
                if (depth < this.scaleMin) {
                    return depth * (this.line1Height / this.scaleMin);
                }
                // 如果深度大于最大刻度，则超出部分每增加0.1，高度增加1（例如从6到6.5增加了5）
                else if (depth > this.scaleMax) {
                    // 标注：修改了超过第二条刻度线时的计算方式
                    return this.line2Height + (depth - this.scaleMax) * 10;
                }
                // 在两条刻度线之间的计算保持线性增长
                else {
                    // 标注：修改了在两条刻度线之间的计算逻辑，使其符合线性比例
                    return (depth - this.scaleMin) * scaleFactor + this.line1Height - (this.scaleMin * scaleFactor);
                }
            }


            // 按压类型判断方法
            getPressType(depth) {
                if (depth > this.scaleMax) return 'danger';     // 过深
                if (depth < this.scaleMin) return 'warning';    // 过浅
                return 'success';                               // 正常
            }

            // 更新图表方法
            updateChart() {
                // 生成新的按压数据
                const depth = this.generatePressDepth();
                const type = this.getPressType(depth);
                const height = this.depthToHeight(depth);
                
                // 将新数据添加到数组开头
                this.pressData.unshift({
                    depth: depth,
                    type: type,
                    height: height
                });
                
                // 保持最近12次按压的数据
                if (this.pressData.length > this.maxBars) {
                    this.pressData.pop();
                }
                
                // 清空图表
                this.chart.innerHTML = '';
                
                // 创建柱状图
                this.pressData.forEach(press => {
                    const bar = document.createElement('div');
                    bar.className = `bar ${press.type}`;
                    bar.style.height = `${press.height}px`;
                    this.chart.appendChild(bar);
                });

                // 更新警告文本
                this.updateWarnings();
            }

            // 生成随机按压深度的范围
            generatePressDepth() {
                // 生成4.5-6.5的随机深度
                return 4.5 + Math.random() * 2;
            }

            // 更新警告文本
            updateWarnings() {
                const warningContainer = document.querySelector('.warnings');
                warningContainer.innerHTML = ''; // 清空之前的警告信息

                // 只检查最新的按压数据
                if (this.pressData.length > 0) {
                    const latestPress = this.pressData[0]; // 获取最新按压数据
                    if (latestPress.type === 'danger') {
                        const warning = document.createElement('span');
                        warning.textContent = '按压过深！'; // 最新数据按压过深时显示
                        warningContainer.appendChild(warning);
                    } else if (latestPress.type === 'warning') {
                        const warning = document.createElement('span');
                        warning.textContent = '按压过浅！'; // 最新数据按压过浅时显示
                        warningContainer.appendChild(warning);
                    } else if (latestPress.type === 'success') {
                        const success = document.createElement('span');
                        success.textContent = '按压正常'; // 新增：当按压正常时显示
                        warningContainer.appendChild(success);
                    }
                }
            }

            // 开始监测
            startMonitoring() {
                // 立即执行一次
                this.updateChart();
                
                // 设置定时更新
                setInterval(() => {
                    this.updateChart();
                }, this.updateInterval);
            }

            // 添加倒计时方法
            startCountdown() {
                this.updateCountdown();
                
                const timer = setInterval(() => {
                    this.remainingTime--;
                    
                    if (this.remainingTime < 0) {
                        clearInterval(timer);
                        this.remainingTime = 0;
                        this.resetCountdown();
                    }
                    
                    this.updateCountdown();
                }, 1000);
            }

            // 更新倒计时显示
            updateCountdown() {
                // 更新进度条
                const progress = (this.remainingTime / this.totalTime) * 100;
                this.progressBar.style.width = `${progress}%`;
                
                // 更新时间显示
                const minutes = Math.floor(this.remainingTime / 60);
                const seconds = this.remainingTime % 60;
                this.timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }

            // 重置倒计时
            resetCountdown() {
                this.remainingTime = this.totalTime;
                this.updateCountdown();
                this.startCountdown();
            }
        }

        // 页面加载完成后启动CPR监测
        window.addEventListener('load', () => {
            new CPRMonitor();
        });
    </script>
</body>
</html> 